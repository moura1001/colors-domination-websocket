<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>WS Colors Domination</title>
        <link rel="stylesheet" href="/stylesheets/main.css">
    </head>
    <body>
        <h1>Colors Domination</h1>
        <button id="btnConnect">Connect to Server</button>
        <button id="btnCreate">New Game</button>
        <button id="btnJoin">Join Game</button>
        <input type="text" id="txtGameId">
        <div id="divPlayers"></div>
        <div id="divBoard"></div>

        <script>
            // Game state
            let wsConn = null;
            let clientId = null;
            let gameId = null;
            let playerColor = null;

            // HTML elements
            const btnConnect = document.getElementById("btnConnect");
            const btnCreate = document.getElementById("btnCreate");
            const btnJoin = document.getElementById("btnJoin");
            const txtGameId = document.getElementById("txtGameId");
            const divPlayers = document.getElementById("divPlayers");
            const divBoard = document.getElementById("divBoard");

            if(window['WebSocket']){

                // HTML events
                btnConnect.addEventListener("click", e => {
                    if(wsConn === null){
                        wsConn = new WebSocket('ws://' + document.location.host + '/ws');
                        console.log("Attempting Connection...");

                        wsConn.onopen = () => {
                            console.log("Successfully Connected");
                        }
                
                        wsConn.onclose = evt => {
                            console.log("Socket Closed Connection: ", evt);
                        }

                        wsConn.onerror = err => {
                            console.log("Socket Error: ", err);
                        }

                        wsConn.onmessage = msg => {
                            const response = JSON.parse(msg.data);

                            // Handle server messages
                            // connect
                            switch(response.method){
                                case "connect":
                                    clientId = response.clientId;
                                    console.log("Client id '%s' get Successfully", clientId);
                                    break;
                                case "create":
                                    gameId = response.game.id;
                                    const message = "Game Successfully created whith id '%s' and a board with '%d' cells"
                                    console.log(message, response.game.id, response.game.cells);
                                    break;
                            }
                        }
                    }
                });

                btnCreate.addEventListener("click", e => {
                    if(wsConn !== null && clientId !== null && gameId === null){
                        const payLoad = {
                            "method": "create",
                            "clientId": clientId
                        }

                        wsConn.send(JSON.stringify(payLoad))
                    }
                });
                
            }
        </script>
    </body>
</html>